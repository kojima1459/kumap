# Bear Map App - TODO

## データベース設計
- [x] クマ出没情報テーブル（bear_sightings）の作成
- [x] データソース区別（公式/ユーザー投稿）
- [x] 都道府県・市町村情報の管理

## バックエンドAPI
- [x] クマ出没情報取得API（地域フィルタリング対応）
- [x] ユーザー投稿API（認証必須）
- [x] 管理者承認API（オプション）

## スクレイピング機能
- [x] Yahoo!ニュースのクマ出没情報ページのスクレイピング
- [x] 各都道府県の公式サイトへのリンク抽出
- [ ] 定期実行機能（cron/scheduled task）

## Googleマップ統合
- [x] Googleマップコンポーネントの実装
- [x] マーカー表示（公式情報とユーザー投稿を区別）
- [x] 情報ウィンドウ（詳細表示）
- [x] 地域別フィルタリング

## ユーザー投稿機能
- [x] 投稿フォーム（位置情報、日時、詳細）
- [ ] 画像アップロード機能
- [ ] 投稿一覧表示
- [ ] 投稿編集・削除機能

## UI/UX
- [x] レスポンシブデザイン
- [x] ローディング状態の実装
- [x] エラーハンドリング
- [x] 地域選択UI

## テスト
- [x] バックエンドAPIのテスト
- [x] スクレイピング機能のテスト
- [ ] フロントエンドのテスト

## 定期実行機能（追加要望）
- [x] 毎日自動でYahoo!ニュースをスクレイピング
- [x] スケジュール設定（毎日特定時刻に実行）
- [x] 重複データの排除ロジック
- [x] スクレイピング結果のログ記録
- [x] 管理者用の手動実行ページ

## 日付フィルター機能（追加要望）
- [x] 日付範囲フィルター（過去1週間、1ヶ月、3ヶ月、全期間）
- [x] マーカーに日時情報を表示
- [x] 情報ウィンドウに詳細な日時表示
- [x] 投稿日時と目撃日時の区別

## 京都府詳細データ追加（追加要望）
- [ ] 京都府GISサイトからの詳細データスクレイピング
- [ ] 具体的な位置情報（緯度経度）の取得
- [ ] 既存スクレイピング機能への統合

## ハイブリッド方式の実装（追加要望）
- [x] Yahoo!ニュースから各都道府県の外部リンクを抽出
- [x] 都道府県別の外部リンクをデータベースに保存
- [x] マップ上で「詳細を見る」ボタンから外部リンクへ誘導
- [ ] 京都府GISデータの詳細スクレイピング（特別対応）
- [ ] 取得しやすい都道府県の追加対応（オプション）

## 正確なURLマッピング（追加要望）
- [x] ユーザー提供の正確な都道府県マップURLをデータベースに反映
- [x] 既存のスクレイピング結果を更新
- [x] URL精度の向上確認

## 通知機能（追加要望）
- [x] ユーザー通知設定テーブルの作成
- [x] 都道府県・地域別の通知設定UI
- [x] 新規出没情報追加時の通知トリガー
- [x] メール通知送信機能（Manus通知API使用）
- [x] 通知設定管理ページ
- [x] 通知履歴の記録

## バグ修正（ユーザー報告）
- [x] Google Maps API重複読み込みエラーの修正（/submitページ）

## 地図上の都道府県別統計表示（追加要望）
- [x] 都道府県別の出没件数集計API
- [x] 地図上に都道府県別の出没件数を表示
- [x] 都道府県をクリックして詳細統計を表示

## Playwright MCPを使用した都道府県別詳細スクレイピング（追加要望）
- [ ] Playwright MCPの初期設定とブラウザインストール
- [ ] 京都府GISデータのスクレイピング実装
- [ ] 北海道ひぐまっぷのスクレイピング実装
- [ ] Google My Maps形式のスクレイピング実装（鳥取、静岡など）
- [ ] ArcGIS Dashboard形式のスクレイピング実装（埼玉、群馬、新潟など）
- [ ] 毎日午前3時の自動実行スケジュール設定
- [ ] エラーハンドリングとリトライロジック

## 都道府県別公式マップリンク表示（追加要望）
- [x] 統計マップの都道府県マーカーに公式リンクを追加
- [x] 「詳細はこちらでも確認できます」メッセージの表示
- [x] 20都道府県の公式URLを統計情報ウィンドウに表示

## メインマップへの公式リンク追加（追加要望）
- [x] MapViewページの情報ウィンドウに都道府県別公式リンクを追加
- [x] 各マーカーのポップアップに「詳細はこちらでも確認できます」メッセージを表示
