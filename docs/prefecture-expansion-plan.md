# 都道府県追加実装計画

## 調査結果サマリー

### 1. くまっぷ（株式会社Xenon）- 最優先 ✅

**概要**:
- 全国のクマ目撃情報を一元管理する公式プラットフォーム
- 公式API提供（テナント申請が必要）
- URL: https://kumap-xenon.web.app/

**テナント機能**:
1. **公式投稿マーク**: テナント投稿にチェックマーク付与
2. **複数人での管理**: メンバー全員でポイントの作成・編集・削除可能
3. **API連携**: 
   - 投稿データをAPI経由で外部システムに提供
   - APIを使って自動的にポイントを作成
   - OpenAPI仕様からクライアントコード自動生成

**今後予定の機能**:
- データ分析・レポート機能
- エリア別通知機能

**API仕様**:
- OpenAPI仕様書: https://kumap-xenon.web.app/openapi.yaml
- エンドポイント:
  * POST /api-points-list: ポイント一覧取得（スコープ: points:read）
  * POST /api-points-create: ポイント作成（スコープ: points:write）
  * POST /api-points-delete: ポイント削除（スコープ: points:delete）

**利用規約**:
- ✅ API利用は合法（テナント申請・承認が必要）
- ❌ スクレイピングは明示的に禁止
- ✅ 「研究機関や行政との連携による熊対策などの目的」での利用は許諾

**テナント申請方法**:
1. https://kumap-xenon.web.app/application からオンライン申請
2. 必要情報:
   - テナント名（例: クマ対策課）
   - テナントID（小文字英数字とハイフン、例: kuma-taisaku）
   - 利用目的（必須）
   - 関連URL（任意）
   - 申請者氏名
   - メールアドレス（承認後、招待メール送信）
3. 管理者審査後、承認

**実装優先度**: 🔴 最優先（全国データを一括取得可能）

---

### 2. 北海道ひぐまっぷ - 保留 ⏸️

**概要**:
- 北海道67市町村が参加する大規模システム
- 運営: ダッピスタジオ合同会社
- URL: https://higumap.info/

**技術スタック**:
- Leaflet.jsベースの地図
- 直近3ヶ月のヒグマ出没情報を公開

**課題**:
- ❓ 利用規約が明示されていない
- ❓ APIの公開状況が不明
- ❓ 運営元への問い合わせが必要

**実装優先度**: ⏸️ 保留（APIの有無確認後に判断）

---

### 3. 京都府GIS - 実装不可 ❌

**概要**:
- 京都府・市町村共同 統合型地図情報システム
- URL: https://g-kyoto.gis.pref.kyoto.lg.jp/g-kyoto/top/select.asp?dtp=676

**利用規約**:
- ❌ **スクレイピングが明示的に禁止**
- ❌ 「コンテンツの複製・改変・転用・電磁的加工・送信・頒布・二次的使用を禁止」
- ❌ 営利目的・商用転用も禁止

**代替案**:
- ✅ 公式サイトへのリンク提供（実装済み）

**実装優先度**: ❌ 実装不可（法的リスクが高い）

---

## 実装計画

### フェーズ1: くまっぷAPI統合（最優先）

**目標**: 全国のクマ目撃情報を一括取得

**ステップ**:
1. ✅ テナント申請フォーム提出
   - テナント名: 「クマップ（Kumap）」
   - テナントID: 「kumap-bear-sighting」
   - 利用目的: 「全国のクマ目撃情報を集約し、地域住民や観光客に安全情報を提供するためのWebアプリケーション開発」
   - 関連URL: 「https://kumamap.com」
   - 申請者情報: ユーザーの情報

2. ⏳ 承認待ち（管理者審査）

3. ⏳ APIキー発行後の実装:
   - OpenAPI Generatorでクライアントコード生成
   - /api-points-list エンドポイントでデータ取得
   - データ変換ロジック実装（くまっぷ形式 → bearSightingsテーブル形式）
   - 重複排除ロジック適用
   - 自動実行スケジュール設定（毎日午前3時）

4. ⏳ テスト実装:
   - APIデータ取得テスト
   - データ変換テスト
   - 重複排除テスト
   - 地図表示テスト

**推定工数**: 3-5日（APIキー取得後）

---

### フェーズ2: 北海道ひぐまっぷ調査（オプション）

**目標**: APIの有無を確認し、実装可能性を判断

**ステップ**:
1. ⏳ ダッピスタジオ合同会社に問い合わせ
   - API公開の有無
   - データ利用の可否
   - 利用規約の確認

2. ⏳ API公開されている場合:
   - API仕様書取得
   - 実装計画策定

3. ⏳ API公開されていない場合:
   - 公式サイトへのリンク提供（代替案）

**推定工数**: 1-2日（問い合わせ対応含む）

---

### フェーズ3: その他の都道府県調査（オプション）

**候補**:
- 東京都TOKYOくまっぷ（Power BI）
- 静岡県、鳥取県、埼玉県、群馬県、新潟県など

**ステップ**:
1. ⏳ 各都道府県の公式サイト調査
2. ⏳ データ形式・API有無の確認
3. ⏳ 利用規約の確認
4. ⏳ 実装可能性の判断

**推定工数**: 2-3日

---

## 現在の実装状況

### ✅ 実装済み
1. **Yahoo!ニューススクレイピング**: 毎日午前1時に自動実行
2. **長野県PDF自動スクレイピング**: 毎日午前2時に自動実行
3. **重複データ排除ロジック**: 3つの基準で重複検出・排除
4. **geocoding機能**: 市町村名を緯度経度に変換

### ⏳ 実装予定
1. **くまっぷAPI統合**: テナント承認後に実装
2. **北海道ひぐまっぷ調査**: API有無確認後に判断
3. **その他の都道府県**: くまっぷAPI統合後に検討

---

## 次のアクション

### 即座に実行可能
1. ✅ くまっぷテナント申請フォーム提出
2. ⏳ 承認待ち（数日～1週間程度）

### 承認後に実行
1. ⏳ APIキー取得
2. ⏳ OpenAPI Generatorでクライアントコード生成
3. ⏳ くまっぷAPI統合実装
4. ⏳ テスト実装と動作確認
5. ⏳ 自動実行スケジュール設定

---

## 結論

**くまっぷAPI統合が最も効率的で法的リスクのない方法**であり、全国のクマ目撃情報を一括取得できるため、最優先で実装すべき。

テナント申請を提出し、承認を待つ間に、他の都道府県の調査を進めることが推奨される。
